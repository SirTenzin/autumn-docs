---
title: "Backend integration"
sidebarTitle: "Backend Only"
description: "Implement your app's payments and pricing model from your backend"
---

In this example we'll create the pricing for a premium AI chatbot. We're going to have:

- A Free plan that gives users 5 chat messages per month for free
- A Pro plan that gives users 100 chat messages per month for $20 per month.

<Info>
  Autumn provides React hooks and components for an easier developer experience.
  If you're not using Typescript, have an unsupported framework or just prefer a
  backend-only setup for full control, use this guide.
</Info>

## 1. Create your products

Create a product for each plan that your app offers. In our example we'll create a "Free" and "Pro" product.

<Tabs>
<Tab title="CLI">

Run the following command in your root directory:

```bash
npx atmn init
```

This will prompt you to login or create an account, and create an `autumn.config.ts` file. Paste in the code below, or view our [config schema](/api-reference/cli/config) to build your own.

```typescript autumn.config.ts [expandable]
import {
  feature,
  product,
  featureItem,
  pricedFeatureItem,
  priceItem,
} from "atmn";

// Features
export const messages = feature({
  id: "messages",
  name: "Messages",
  type: "single_use",
});

// Products
export const free = product({
  id: "free",
  name: "Free",
  items: [
    // 5 messages per month
    featureItem({
      feature_id: messages.id,
      included_usage: 5,
      interval: "month",
    }),
  ],
});

export const pro = product({
  id: "pro",
  name: "Pro",
  items: [
    // 100 messages per month
    featureItem({
      feature_id: messages.id,
      included_usage: 100,
      interval: "month",
    }),
    // $20 per month
    priceItem({
      price: 20,
      interval: "month",
    }),
  ],
});
```

Then, push your changes to Autumn's sandbox environment.

```bash
npx atmn push
```

<Tip>
  If you already have products created in the dashboard, run `npx atmn pull` to
  pull them into your local config.
</Tip>

</Tab>
<Tab title="Dashboard">
Create your [Autumn account](https://app.useautumn.com/), and the Free and Pro plans in the [Products](https://app.useautumn.com/products) tab.
<AccordionGroup>

  <Accordion title="Free Product">
    Click on the **+ Product** button and name the product "Free". 
    
    Toggle on the **Default** switch so that it is enabled for customers automatically when they're created.
    <Frame>
      <img
        src="/assets/quickstart/create-free.png"

      />
    </Frame>

    Click on the **+ Feature** button and create a single-use "Messages" feature.

    <Frame>
      <img
        src="/assets/quickstart/create-feature.png"

      />
    </Frame>

    Add a limit of 5 messages per month.

    <Frame>
      <img
        src="/assets/quickstart/free-messages.png"

      />
    </Frame>

    Click on the **Add Item** button, then on the **Create Product** button.

    <Frame>
      <img
        src="/assets/quickstart/free-product.png"

      />
    </Frame>

  </Accordion>

  <Accordion title="Pro Product">
  Back on the products page, click on the **+ Product** button and name it "Pro".

  <Frame>
    <img
      src="/assets/quickstart/create-pro.png"

    />

  </Frame>

Click on the **+ Feature** button and select the "Messages" feature that we created for the Free product.

Add a limit of 100 messages per month.

  <Frame>
    <img
      src="/assets/quickstart/pro-messages.png"

    />

  </Frame>

Click on the **+ Price** button and add a price of $20 per month.

  <Frame>
    <img
      src="/assets/quickstart/pro-price.png"

    />

  </Frame>

Click on the **Create Product** button.

  <Frame>
    <img
      src="/assets/quickstart/pro-product.png"

    />

  </Frame>

  </Accordion>
</AccordionGroup>
</Tab>
</Tabs>

## 2. Stripe Payments

#### Checkout

Call the `checkout` function to get Stripe checkout page when the customer wants to purchase the Pro plan, and pass it to your frontend. Once they've paid, Autumn will grant them access to the features we defined.

If their payment details are already on file, checkout data (eg, prices) will be returned instead to be displayed to the customer. This lets them confirm their upgrade, downgrade or new purchase.

<Warning>
  Make sure you've pasted in your [Stripe test secret
  key](https://dashboard.stripe.com/test/apikeys) `sk_test_...` in the [Autumn
  dashboard](https://app.useautumn.com/integrations/stripe).
</Warning>

<CodeGroup>

```typescript Node.js
import { Autumn } from "autumn-js";

const autumn = new Autumn({ secretKey: "am_sk_..." });

const { data } = await autumn.checkout({
  customer_id: "user_123",
  product_id: "pro",
});
```

```python Python
import asyncio
from autumn import Autumn

autumn = Autumn("am_sk_1234567890")

async def main():
  response = await autumn.checkout(
      customer_id='user_123',
      product_id='pro'
  )

asyncio.run(main())
```

```bash cURL
curl -X POST 'https://api.useautumn.com/v1/attach' \
-H 'Authorization: Bearer am_sk_1234567890' \
-H 'Content-Type: application/json' \
-d '{
  "customer_id": "user_123",
  "product_id": "pro"
}'
```

</CodeGroup>

#### Attach

If the payment details are on file and the customer is ready to make the payment, use the `attach` function to enable the product (and charge the customer if applicable).

## 4. Build Pricing Logic

There are 3 key functions you need to handle the billing logic once the customer has purchased the Pro plan:

- `check` for feature access to see if the customer is allowed to send a message.
- `track` a usage event in Autumn
- `customer` to display usage data in the UI.

#### Client-side

The `customer` object is a single state that contains all the billing data for your user (subscription states, feature permissions, usage balances, etc).

Use the client-side `check` function to gate features and show paywalls. This is determined by reading the local `customer` state, so no API call is made.

```jsx send-message.tsx
import { useCustomer } from "autumn-js/react";

export default function SendChatMessage() {
  const { customer, check, refetch } = useCustomer();

  return (
    <>
      <button
        onClick={async () => {
          const { data } = check({ featureId: "messages" });

          if (!data?.allowed) {
            alert("You're out of messages");
          } else {
            //send chatbot message server-side, then
            await refetch(); // refetch customer usage data

            //display remaining messages
            const messages = customer?.features.messages;
            console.log("Remaining messages: " + messages?.balance);
          }
        }}
      >
        Send AI Message
      </button>
    </>
  );
}
```

#### Server-side

You should handle feature access checks on the backend too for security. The server-side `check` function makes an API call to Autumn's DB to fetch the latest information.

```typescript send-message.ts
import { Autumn as autumn } from "autumn-js";

const { data } = await autumn.check({
  customer_id: "user_123", // same user id from auth as in the autumn handler
  feature_id: "messages",
});

// server-side function to send the message
// then record the usage in Autumn

await autumn.track({
  customer_id: "user_123",
  feature_id: "messages",
});
```

**Congrats ðŸŽ‰**

Nice! You've now integrated Autumn into your application. You can make pricing changes through the dashboard/CLI and it'll automatically update in your app.

Next steps:

- Add Stripe's [billing portal](/api-reference/hooks/useCustomer#openbillingportal)
- Handle failed payments
- Use our UI [components](/quickstart/shadcn) to show a pricing table, and handle upgrades, downgrades and paywalls.
