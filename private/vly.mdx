---
title: 'vly.ai onboarding'
---

### Set up

We've already created products and features for you. Below are the IDs for features, products and event names to use. The value for `customerId` below is an example.

```js
const BASE_URL = "https://api.useautumn.com/v1"
const API_KEY = "am_test_3ZZXSyWpG7k3hjS6zrcfUoWv"

const customerId = "123"
const productId = "starter" // or 'pro' or 'agency'

const featureId = 'testing-minutes' // or 'projects'
const eventName = 'minutes_used' // or 'project_created
```

### Step 1: Connect to Stripe

Navigate to the “Connect to Stripe” tab on the SIdebar, and submit your details.

### Step 2: Create a customer

* Takes in `id`, `name`, and `email`.

* `id` is your own stored ID for that customer

```js
const response = await fetch(`${BASE_URL}/customers`, {
	method: "POST",
	body: JSON.stringify({
		id: customerId,
		name: "John Doe",
		email: "john.doe@example.com"
	}),
	headers: {
		"Content-Type": "application/json",
		"Authorization": `Bearer ${API_KEY}`
	},
});
```

### Step 3: Attach product to customer

* Takes in `product_id` and `customer_id`

* Even if a customer is on an existing product (aka plan), you can call this same endpoint with another `product_id` and we will handle the upgrade / downgrade for you. Upgrades happen immediately (with proration), while downgrades happen at the end of the cycle.

```js
const response = await fetch(`${BASE_URL}/attach`, {
	method: "POST",
	body: JSON.stringify({
		product_id: productId,
		customer_id: customerId,
	}),
	headers: {
		"Content-Type": "application/json",
		Authorization: `Bearer ${API_KEY}`,
	},
});

const result = await response.json();

if (result.checkout_url) {
	console.log(result.checkout_url);
}
```

### Step 4: Check if customer is entitled to feature and send event to update

* Entitled takes in `customer_id` and `feature_id` as query params. It returns `allowed` which is true if customer is allowed that feature or false if not. Additionally, it returns `balances`, a list which helps you understand if a customer is not allowed a feature.

* Sending an event takes in `customer_id`, `event_name` and `properties`

* Since the features we're sending events for are aggregated by `SUM` (see the Features tab on the dashboard), we must pass in `value` in `properties` which is how much the feature balance for that customer will increment or decrement by

```js
// 1. Check entitlement
const response = await fetch(`${BASE_URL}/entitled?customer_id=${customerId}&feature_id=${featureId}`, {
	method: "GET",
	headers: {
		"Authorization": `Bearer ${API_KEY}`,
	},
});

const entitledData = await response.json();

// 2. Send event if allowed
if (entitledData.allowed) {

	let eventData = {
		customer_id: customerId,
		event_name: eventName, // use 'minutes_used' (to increment 'test-minutes') or 'project_created' (to increment 'projects')
		properties: {
			value: 10, // this will be added to the customer's usage
		},
	}

	await fetch(`${BASE_URL}/events`, {
		method: "POST",
		body: JSON.stringify(eventData),
		headers: {
			"Content-Type": "application/json",
			"Authorization": `Bearer ${API_KEY}`,
		},
	});
}
```

### Congrats, you’re done!

Looking forward to hearing how you found this integration and any feedback you have :)