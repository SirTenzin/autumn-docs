---
title: "Integration Guide"
sidebarTitle: "Integration"
description: "Implement your app's payments and pricing model in under 5 minutes"
---

Create your [Autumn account](https://app.useautumn.com/) and let's create the pricing for a premium AI chatbot.

We're going to have:

- A Free plan that gives users **5 chat messages per month** for free
- A Pro plan that gives users **100 chat messages per month** for **$20 per month**.

## 1. Create your products

Create a product for each plan that your app offers. In our example we'll create a "Free" and "Pro" product.

<Tabs>
<Tab title="Using the CLI">

Run the following command in your root directory:

```bash
npx atmn init
```

This will create a `autumn.config.ts` file in your root directory and prompt you to login / create an account. Add the following code to your `autumn.config.ts` file.

```typescript autumn.config.ts [expandable]
import {
  feature,
  product,
  featureItem,
  pricedFeatureItem,
  priceItem,
} from "atmn";

// Features
export const messages = feature({
  id: "messages",
  name: "Messages",
  type: "single_use",
});

// Products
export const free = product({
  id: "free",
  name: "Free",
  items: [
    // 5 messages per month
    featureItem({
      feature_id: messages.id,
      included_usage: 5,
      interval: "month",
    }),
  ],
});

export const pro = product({
  id: "pro",
  name: "Pro",
  items: [
    // 100 messages per month
    featureItem({
      feature_id: messages.id,
      included_usage: 100,
      interval: "month",
    }),
    // $20 per month
    priceItem({
      price: 20,
      interval: "month",
    }),
  ],
});
```

Then, push your changes to Autumn's sandbox environment.

```bash
npx atmn push
```

<Tip>
  If you already have products created in the dashboard, run `npx atmn pull` to
  pull them into your local config.
</Tip>

</Tab>
<Tab title="Dashboard">
Create the Free and Pro plans in the [Products](https://app.useautumn.com/products) tab.
<AccordionGroup>

  <Accordion title="Free Product">
    Click on the **+ Product** button and name the product "Free". 
    
    Toggle on the **Default** switch so that it is enabled for customers automatically when they're created.
    <Frame>
      <img
        src="/assets/quickstart/create-free.png"

      />
    </Frame>

    Click on the **+ Feature** button and create a single-use "Messages" feature.

    <Frame>
      <img
        src="/assets/quickstart/create-feature.png"

      />
    </Frame>

    Add a limit of 5 messages per month.

    <Frame>
      <img
        src="/assets/quickstart/free-messages.png"

      />
    </Frame>

    Click on the **Add Item** button, then on the **Create Product** button.

    <Frame>
      <img
        src="/assets/quickstart/free-product.png"

      />
    </Frame>

  </Accordion>

  <Accordion title="Pro Product">
  Back on the products page, click on the **+ Product** button and name it "Pro".

  <Frame>
    <img
      src="/assets/quickstart/create-pro.png"

    />

  </Frame>

Click on the **+ Feature** button and select the "Messages" feature that we created for the Free product.

Add a limit of 100 messages per month.

  <Frame>
    <img
      src="/assets/quickstart/pro-messages.png"

    />

  </Frame>

Click on the **+ Price** button and add a price of $20 per month.

  <Frame>
    <img
      src="/assets/quickstart/pro-price.png"

    />

  </Frame>

Click on the **Create Product** button.

  <Frame>
    <img
      src="/assets/quickstart/pro-product.png"

    />

  </Frame>

  </Accordion>
</AccordionGroup>
</Tab>
</Tabs>

## 2. Setup Autumn

#### Install `autumn-js`

<CodeGroup>

```bash npm
npm install autumn-js
```

```bash pnpm
pnpm add autumn-js
```

```bash yarn
yarn add autumn-js
```

```bash bun
bun add autumn-js
```

</CodeGroup>

<Note>
  If you're using a separate backend and frontend, make sure to install the
  library in both.
</Note>

#### Add your Autumn secret key

Create an [Autumn Secret API key](https://app.useautumn.com/dev) from the dashboard, and add it to your backend `.env` file.

```bash .env
AUTUMN_SECRET_KEY=am_sk_1234567890
```

#### Add Server-Side Route

Server-side, mount the handler. This will create routes in the `/api/autumn/*` path, which will be called by Autumn's frontend React [library](/api-reference/hooks/useCustomer). These routes in turn call Autumn's API.

The handler takes in an `identify` function that should return a `customerId`. This is typically your internal user ID or organization ID from your auth provider.

<CodeGroup>

```typescript Next.js
// app/api/autumn/[...all]/route.ts

import { autumnHandler } from "autumn-js/next";
import { auth } from "@/lib/auth";

export const { GET, POST } = autumnHandler({
  identify: async (request) => {
    // get the user from your auth provider (example: better-auth)
    const session = await auth.api.getSession({
      headers: request.headers,
    });

    return {
      customerId: session?.user.id,
      customerData: {
        name: session?.user.name,
        email: session?.user.email,
      },
    };
  },
});
```

```typescript React Router
// app/routes/api.autumn.tsx

import { autumnHandler } from "autumn-js/react-router";
import { auth } from "../lib/auth.server";

export const { loader, action } = autumnHandler({
  identify: async (args) => {
    // get the user from your auth provider (example: better-auth)
    const session = await auth.api.getSession({
      headers: args.request.headers,
    });

    return {
      customerId: session?.user.id,
      customerData: {
        name: session?.user.name,
        email: session?.user.email,
      },
    };
  },
});

//routes.ts
import { type RouteConfig, index, route } from "@react-router/dev/routes";

export default [
  index("routes/home.tsx"),
  route("api/autumn/*", "routes/api.autumn.tsx"),
] satisfies RouteConfig;
```

```typescript Tanstack Start
// routes/api/autumn.$.ts

import { createAPIFileRoute } from "@tanstack/react-start/api";
import { auth } from "~/lib/auth";
import { autumnHandler } from "autumn-js/tanstack";

const handler = autumnHandler({
  identify: async ({ request }) => {
    // get the user from your auth provider (example: better-auth)
    const session = await auth.api.getSession({
      headers: request.headers,
    });

    return {
      customerId: session?.user.id,
      customerData: {
        name: session?.user.name,
        email: session?.user.email,
      },
    };
  },
});

export const APIRoute = createAPIFileRoute("/api/autumn/$")(handler);
```

```typescript Hono
//index.ts

import { autumnHandler } from "autumn-js/hono";

app.use(
  "/api/autumn/*",
  autumnHandler({
    identify: async (c: Context) => {
      // get the user from your auth provider (example: better-auth)
      const session = await auth.api.getSession({
        headers: c.req.raw.headers,
      });

      return {
        customerId: session?.user.id,
        customerData: {
          name: session?.user.name,
          email: session?.user.email,
        },
      };
    },
  })
);
```

```typescript Express
//index.ts

import { autumnHandler } from "autumn-js/express";

app.use(express.json()); // need to parse request body before autumnHandler
app.use(
  "/api/autumn",
  autumnHandler({
    identify: async (req) => {
      // get the user from your auth provider (example: better-auth)
      const session = await auth.api.getSession({
        headers: fromNodeHeaders(req.headers),
      });

      return {
        customerId: session?.user.id,
        customerData: {
          name: session?.user.name,
          email: session?.user.email,
        },
      };
    },
  })
);
```

```typescript Convex
//convex/http.ts

import { httpRouter } from "convex/server";
import { httpAction } from "./_generated/server";
import { autumnHandler } from "autumn-js/convex";
import { ROUTABLE_HTTP_METHODS } from "convex/server";

const http = httpRouter();
const handler = autumnHandler({
  httpAction,
  identify: async () => {
    // get the user from your auth provider (example: better-auth)
    const session = await auth.api.getSession({
      headers: request.headers,
    });

    return {
      customerId: session?.user.id,
      customerData: {
        name: session?.user.name,
        email: session?.user.email,
      },
    };
  },
});

for (const method of ROUTABLE_HTTP_METHODS) {
  http.route({
    pathPrefix: "/api/autumn/",
    method,
    handler,
  });
}

// Convex expects the router to be the default export of `convex/http.js`.
export default http;
```

```typescript Fastify
//index.ts

import { autumnHandler } from "autumn-js/fastify";

fastify.route({
  method: ["GET", "POST"],
  url: "/api/autumn/*",
  handler: autumnHandler({
    identify: async (request) => {
      // get the user from your auth provider (example: better-auth)
      const session = await auth.api.getSession({
        headers: request.headers as any,
      });

      return {
        customerId: session?.user.id,
        customerData: {
          name: session?.user.name,
          email: session?.user.email,
        },
      };
    },
  }),
});
```

```typescript Supabase
//supabase/functions/autumn/index.ts

import { autumnHandler } from "npm:autumn-js/supabase";
import { createClient } from "https://esm.sh/@supabase/supabase-js@2.49.9";
const corsHeaders = {
  "Access-Control-Allow-Origin": "*",
  "Access-Control-Allow-Methods": "GET, POST, PUT, DELETE, OPTIONS",
  "Access-Control-Allow-Headers": "Content-Type, Authorization",
};

Deno.serve(async (req: Request) => {
  if (req.method === "OPTIONS") {
    return new Response("ok", { headers: corsHeaders });
  }

  //supabase auth
  const supabaseClient = createClient(
    Deno.env.get("SUPABASE_URL") ?? "",
    Deno.env.get("SUPABASE_ANON_KEY") ?? "",
    {
      global: {
        headers: { Authorization: req.headers.get("Authorization") },
      },
    }
  );

  const { data, error } = await supabaseClient.auth.getUser();

  const handler = autumnHandler({
    corsHeaders,
    identify: async () => {
      return {
        customerId: data.user?.id,
        customerData: {
          email: data.user?.email,
        },
      };
    },
  });

  return handler(req);
});
```

</CodeGroup>
<Check>
  Autumn will automatically create a customer if the customer ID is new.
</Check>

#### Add Client-Side Provider

Client side, wrap your application with the `<AutumnProvider>` component, and pass in your backend URL. This lets Autumn know how to reach the backend handler you mounted in the previous step.

<Note>
  If you're using a fullstack framework like Next.js, your backend URL will be
  the same as your frontend URL (eg http://localhost:3000).
</Note>

<CodeGroup>

```bash Next.js
NEXT_PUBLIC_AUTUMN_BACKEND_URL=http://localhost:3000
```

```bash Vite
VITE_AUTUMN_BACKEND_URL=http://localhost:8000
```

</CodeGroup>

<CodeGroup>
```jsx Next.js
import { AutumnProvider } from "autumn-js/react";

export default function RootLayout({
  children,
}: {
  children: React.ReactNode,
}) {
  return (
    <html>
      <body>
        <AutumnProvider backendUrl={process.env.NEXT_PUBLIC_AUTUMN_BACKEND_URL}>
          {children}
        </AutumnProvider>
      </body>
    </html>
  );
}
```

```jsx Vite
import { AutumnProvider } from "autumn-js/react";

export default function RootLayout({
  children,
}: {
  children: React.ReactNode,
}) {
  return (
    <html>
      <body>
        <AutumnProvider backendUrl={import.meta.env.VITE_AUTUMN_BACKEND_URL}>
          {children}
        </AutumnProvider>
      </body>
    </html>
  );
}
```

</CodeGroup>

<Info>
  `The Provider component can also take in a `getBearerToken` function, which should be used
  for auth frameworks with separate backend and frontend, eg using Clerk with
  Express. This will pass in the `Authorization` header from the request to the
  backend, which can be used in the `autumnHandler` identify function.

</Info>

## 3. Enable Stripe Payments

Call `checkout` to redirect the customer to a Stripe checkout page when they want to purchase the Pro plan. Once they've paid, Autumn will grant them access to the features we defined.

If their payment method is already on file, `CheckoutDialog` will open instead to let the customer confirm their new subscription or purchase, then handle the payment.

Alternatively, use our [PricingTable](/quickstart/shadcn#pricing-table) component to show a pricing table that handles the checkout for you.

<Warning>
  Make sure you've pasted in your [Stripe test secret
  key](https://dashboard.stripe.com/test/apikeys) `sk_test_...` in the [Autumn
  dashboard](https://app.useautumn.com/integrations/stripe).
</Warning>

```jsx React
import { useCustomer, CheckoutDialog } from "autumn-js/react";

export default function PurchaseButton() {
  const { checkout } = useCustomer();

  return (
    <button
      onClick={async () => {
        await checkout({
          productId: "pro",
          dialog: CheckoutDialog,
        });
      }}
    >
      Upgrade to Pro
    </button>
  );
}
```

## 4. Handle Pricing Logic

There are 3 key functions you need to handle the billing logic once the customer has purchased the Pro plan:

- `check` for feature access to see if the customer is allowed to send a message.
- `track` a usage event in Autumn (typically done server-side)
- `customer` to display usage data in the UI.

#### Client-side

```jsx send-message.tsx
import { useCustomer } from "autumn-js/react";

export default function SendChatMessage() {
  const { customer, check, refetch } = useCustomer();

  return (
    <>
      <button
        onClick={async () => {
          const { data } = await check({ featureId: "messages" });

          if (data?.allowed) {
            //... send chatbot message server-side, then
            await refetch(); // refetch customer usage data
            alert(
              "Remaining messages: " + customer?.features.messages?.balance
            );
          } else {
            alert("You're out of messages");
          }
        }}
      >
        Send Message
      </button>
    </>
  );
}
```

#### Server-side

You should handle feature access checks on the backend too for security.

```typescript send-message.ts
import { Autumn as autumn } from "autumn-js";

const { data } = await autumn.check({
  customer_id: "user_123", // same user id from auth as in the autumn handler
  feature_id: "messages",
});

// server-side function to send the message
//then record the usage

await autumn.track({
  customer_id: "user_123",
  feature_id: "messages",
});
```

## 5. Next steps

Nice! You've now integrated Autumn into your application. Next, learn how to use Autumn's [components](/quickstart/shadcn) to show a pricing table, and handle upgrades, downgrades and paywalls.
