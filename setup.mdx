---
title: "Getting Started"
description: "Implement your React + Node.js app's payments and pricing model"
---

In this example we'll create the pricing for a premium AI chatbot. We're going to have:

- A Free plan that gives users 5 chat messages per month for free
- A Pro plan that gives users 100 chat messages per month for $20 per month.

## 1. Create your products

Create a product for each plan that your app offers. In our example we'll create a "Free" and "Pro" product.

<Tabs>
<Tab title="CLI">

Run the following command in your root directory:

```bash
npx atmn init
```

This will prompt you to login or create an account, and create an `autumn.config.ts` file. Paste in the code below, or view our [config schema](/api-reference/cli/config) to build your own.

```typescript autumn.config.ts [expandable]
import {
  feature,
  product,
  featureItem,
  pricedFeatureItem,
  priceItem,
} from "atmn";

// Features
export const messages = feature({
  id: "messages",
  name: "Messages",
  type: "single_use",
});

// Products
export const free = product({
  id: "free",
  name: "Free",
  items: [
    // 5 messages per month
    featureItem({
      feature_id: messages.id,
      included_usage: 5,
      interval: "month",
    }),
  ],
});

export const pro = product({
  id: "pro",
  name: "Pro",
  items: [
    // 100 messages per month
    featureItem({
      feature_id: messages.id,
      included_usage: 100,
      interval: "month",
    }),
    // $20 per month
    priceItem({
      price: 20,
      interval: "month",
    }),
  ],
});
```

Then, push your changes to Autumn's sandbox environment.

```bash
npx atmn push
```

<Tip>
  If you already have products created in the dashboard, run `npx atmn pull` to
  pull them into your local config.
</Tip>

</Tab>
<Tab title="Dashboard">
Create your [Autumn account](https://app.useautumn.com/), and the Free and Pro plans in the [Products](https://app.useautumn.com/products) tab.
<AccordionGroup>

  <Accordion title="Free Product">
    Click on the **+ Product** button and name the product "Free". 
    
    Toggle on the **Default** switch so that it is enabled for customers automatically when they're created.
    <Frame>
      <img
        src="/assets/quickstart/create-free.png"

      />
    </Frame>

    Click on the **+ Feature** button and create a single-use "Messages" feature.

    <Frame>
      <img
        src="/assets/quickstart/create-feature.png"

      />
    </Frame>

    Add a limit of 5 messages per month.

    <Frame>
      <img
        src="/assets/quickstart/free-messages.png"

      />
    </Frame>

    Click on the **Add Item** button, then on the **Create Product** button.

    <Frame>
      <img
        src="/assets/quickstart/free-product.png"

      />
    </Frame>

  </Accordion>

  <Accordion title="Pro Product">
  Back on the products page, click on the **+ Product** button and name it "Pro".

  <Frame>
    <img
      src="/assets/quickstart/create-pro.png"

    />

  </Frame>

Click on the **+ Feature** button and select the "Messages" feature that we created for the Free product.

Add a limit of 100 messages per month.

  <Frame>
    <img
      src="/assets/quickstart/pro-messages.png"

    />

  </Frame>

Click on the **+ Price** button and add a price of $20 per month.

  <Frame>
    <img
      src="/assets/quickstart/pro-price.png"

    />

  </Frame>

Click on the **Create Product** button.

  <Frame>
    <img
      src="/assets/quickstart/pro-product.png"

    />

  </Frame>

  </Accordion>
</AccordionGroup>
</Tab>
</Tabs>

## 2. Setup Autumn

Install `autumn-js`

<CodeGroup>

```bash npm
npm install autumn-js
```

```bash pnpm
pnpm add autumn-js
```

```bash yarn
yarn add autumn-js
```

```bash bun
bun add autumn-js
```

</CodeGroup>

<Note>
  If you're using a separate backend and frontend, make sure to install the
  library in both.
</Note>

Then create an [Autumn Secret API key](https://app.useautumn.com/dev) from the dashboard, and add it to your backend `.env` file. If you're using the CLI this should already be done for you.

```bash .env
AUTUMN_SECRET_KEY=am_sk_1234567890
```

#### Add Endpoints Server-side

Server-side, mount the Autumn handler. This will create endpoints in the `/api/autumn/*` path, which will be called by Autumn's frontend React [library](/api-reference/hooks/useCustomer). These endpoints in turn call Autumn's API.

The handler takes in an `identify` function where you should pass in the user ID or organization ID from your auth provider.

<CodeGroup>

```typescript Next.js
// app/api/autumn/[...all]/route.ts

import { autumnHandler } from "autumn-js/next";
import { auth } from "@/lib/auth";

export const { GET, POST } = autumnHandler({
  identify: async (request) => {
    // get the user from your auth provider (example: better-auth)
    const session = await auth.api.getSession({
      headers: request.headers,
    });

    return {
      customerId: session?.user.id, //or org ID
      customerData: {
        name: session?.user.name,
        email: session?.user.email,
      },
    };
  },
});
```

```typescript React Router
// app/routes/api.autumn.tsx

import { autumnHandler } from "autumn-js/react-router";
import { auth } from "../lib/auth.server";

export const { loader, action } = autumnHandler({
  identify: async (args) => {
    // get the user from your auth provider (example: better-auth)
    const session = await auth.api.getSession({
      headers: args.request.headers,
    });

    return {
      customerId: session?.user.id,
      customerData: {
        name: session?.user.name,
        email: session?.user.email,
      },
    };
  },
});

//routes.ts
import { type RouteConfig, index, route } from "@react-router/dev/routes";

export default [
  index("routes/home.tsx"),
  route("api/autumn/*", "routes/api.autumn.tsx"),
] satisfies RouteConfig;
```

```typescript Tanstack Start
// routes/api/autumn.$.ts

import { createAPIFileRoute } from "@tanstack/react-start/api";
import { auth } from "~/lib/auth";
import { autumnHandler } from "autumn-js/tanstack";

const handler = autumnHandler({
  identify: async ({ request }) => {
    // get the user from your auth provider (example: better-auth)
    const session = await auth.api.getSession({
      headers: request.headers,
    });

    return {
      customerId: session?.user.id,
      customerData: {
        name: session?.user.name,
        email: session?.user.email,
      },
    };
  },
});

export const APIRoute = createAPIFileRoute("/api/autumn/$")(handler);
```

```typescript Hono
//index.ts

import { autumnHandler } from "autumn-js/hono";

app.use(
  "/api/autumn/*",
  autumnHandler({
    identify: async (c: Context) => {
      // get the user from your auth provider (example: better-auth)
      const session = await auth.api.getSession({
        headers: c.req.raw.headers,
      });

      return {
        customerId: session?.user.id,
        customerData: {
          name: session?.user.name,
          email: session?.user.email,
        },
      };
    },
  })
);
```

```typescript Express
//index.ts

import { autumnHandler } from "autumn-js/express";

// You need to parse request body BEFORE autumnHandler
app.use(express.json());

app.use(
  "/api/autumn",
  autumnHandler({
    identify: async (req) => {
      // get the user from your auth provider (example: better-auth)
      const session = await auth.api.getSession({
        headers: fromNodeHeaders(req.headers),
      });

      return {
        customerId: session?.user.id,
        customerData: {
          name: session?.user.name,
          email: session?.user.email,
        },
      };
    },
  })
);
```

```typescript Fastify
//index.ts

import { autumnHandler } from "autumn-js/fastify";

fastify.route({
  method: ["GET", "POST"],
  url: "/api/autumn/*",
  handler: autumnHandler({
    identify: async (request) => {
      // get the user from your auth provider (example: better-auth)
      const session = await auth.api.getSession({
        headers: request.headers as any,
      });

      return {
        customerId: session?.user.id,
        customerData: {
          name: session?.user.name,
          email: session?.user.email,
        },
      };
    },
  }),
});
```

```typescript Supabase
//supabase/functions/autumn/index.ts
//You will need to use the getBearerToken function in the AutumnProvider if you're using SupabaseAuth

import { autumnHandler } from "npm:autumn-js/supabase";
import { createClient } from "https://esm.sh/@supabase/supabase-js@2.49.9";
const corsHeaders = {
  "Access-Control-Allow-Origin": "*",
  "Access-Control-Allow-Methods": "GET, POST, PUT, DELETE, OPTIONS",
  "Access-Control-Allow-Headers": "Content-Type, Authorization",
};

Deno.serve(async (req: Request) => {
  if (req.method === "OPTIONS") {
    return new Response("ok", { headers: corsHeaders });
  }

  //supabase auth
  const supabaseClient = createClient(
    Deno.env.get("SUPABASE_URL") ?? "",
    Deno.env.get("SUPABASE_ANON_KEY") ?? "",
    {
      global: {
        headers: { Authorization: req.headers.get("Authorization") },
      },
    }
  );

  const { data, error } = await supabaseClient.auth.getUser();

  const handler = autumnHandler({
    corsHeaders,
    identify: async () => {
      return {
        customerId: data.user?.id,
        customerData: {
          email: data.user?.email,
        },
      };
    },
  });

  return handler(req);
});
```

</CodeGroup>
<Check>
  Autumn will automatically create a customer if the customer ID is new.
</Check>

#### Add Provider Client-side

Client side, wrap your application with the `<AutumnProvider>` component.

If your backend is hosted on a separate URL (eg, when using Vite), pass it into the `backendUrl` prop.

{/* prettier-ignore */}
{/* <Note>
If you're using a fullstack framework like Next.js, your backend URL will be
the same as your frontend URL (eg http://localhost:3000).

</Note>

<CodeGroup>

```bash Next.js
NEXT_PUBLIC_AUTUMN_BACKEND_URL=http://localhost:3000
```

```bash Vite
VITE_AUTUMN_BACKEND_URL=http://localhost:8000
```

</CodeGroup> */}

<CodeGroup>
```jsx Next.js
//layout.tsx
import { AutumnProvider } from "autumn-js/react";

export default function RootLayout({
  children,
}: {
  children: React.ReactNode,
}) {
  return (
    <html>
      <body>
        <AutumnProvider>
          {children}
        </AutumnProvider>
      </body>
    </html>
  );
}
```

```jsx Vite
//.env
VITE_AUTUMN_BACKEND_URL=http://localhost:8000

//page.tsx
import { AutumnProvider } from "autumn-js/react";

export default function RootLayout({
  children,
}: {
  children: React.ReactNode,
}) {
  return (
    <html>
      <body>
        <AutumnProvider backendUrl={import.meta.env.VITE_AUTUMN_BACKEND_URL}>
          {children}
        </AutumnProvider>
      </body>
    </html>
  );
}
```

</CodeGroup>

<Info>
  The Provider component can also take in a `getBearerToken` function, which should be used
  for auth frameworks with separate backend and frontend, eg using Clerk with
  Express. 
  
  This will pass the auth token in the `Authorization` header from the request to the
  backend, which can be used in the `autumnHandler` identify function.

</Info>

<Note>
  CORS issues? Please [reach out](https://discord.gg/STqxY92zuS) and we'll help
  you ASAP. Or try a [backend-only](/setup/backend) setup.
</Note>

## 3. Stripe Payments

Call `checkout` to redirect the customer to a Stripe checkout page when they want to purchase the Pro plan. Once they've paid, Autumn will grant them access to the features we defined.

If their payment details are already on file, [`CheckoutDialog`](/setup/shadcn#checkout-dialog) will open instead to let the customer confirm their upgrade, downgrade or new purchase, then handle the payment.

<Tip>
  You can alternatively use our [PricingTable](/setup/shadcn#pricing-table)
  component, or [roll your own](/setup/roll) flows using our API.
</Tip>

```jsx React
import { useCustomer, CheckoutDialog } from "autumn-js/react";

export default function PurchaseButton() {
  const { checkout } = useCustomer();

  return (
    <button
      onClick={async () => {
        await checkout({
          productId: "pro",
          dialog: CheckoutDialog,
        });
      }}
    >
      Upgrade to Pro
    </button>
  );
}
```

<Warning>
  Make sure you've pasted in your [Stripe test secret
  key](https://dashboard.stripe.com/test/apikeys) `sk_test_...` in the [Autumn
  dashboard](https://app.useautumn.com/integrations/stripe).
</Warning>

## 4. Build Pricing Logic

There are 3 key functions you need to handle the billing logic once the customer has purchased the Pro plan:

- `check` for feature access to see if the customer is allowed to send a message.
- `track` a usage event in Autumn
- `customer` to display usage data in the UI.

#### Server-side

The server-side `check` function makes an API call to Autumn's DB to fetch the latest information.

<Note>You should always handle access checks server-side for security.</Note>

```typescript send-message.ts
import { Autumn as autumn } from "autumn-js";

// same user id from auth as in the autumn handler
const { data } = await autumn.check({
  customer_id: "user_123",
  feature_id: "messages",
});
if (!data?.allowed) {
  console.log("No more messages for you buddy!");
  return;
}

// ... your own function to send the message

// then record the usage in Autumn
await autumn.track({
  customer_id: "user_123",
  feature_id: "messages",
});
```

#### Client-side

The `customer` object is a single state that contains all the billing data for your user (subscription states, feature permissions, usage balances, etc).

Use the client-side `check` function to gate features and show paywalls. This is determined by reading the local `customer` state, so no API call is made.

```jsx send-message.tsx
import { useCustomer } from "autumn-js/react";

export default function SendChatMessage() {
  const { customer, check, refetch } = useCustomer();

  return (
    <>
      <button
        onClick={async () => {
          const { data } = check({ featureId: "messages" });

          if (!data?.allowed) {
            alert("You're out of messages");
          } else {
            //send chatbot message server-side, then
            await refetch(); // refetch customer usage data

            //display remaining messages
            const messages = customer?.features.messages;
            console.log("Remaining messages: " + messages?.balance);
          }
        }}
      >
        Send AI Message
      </button>
    </>
  );
}
```

**Congrats ðŸŽ‰**

Nice! You've now integrated Autumn into your application. You can make pricing changes through the dashboard/CLI and it'll automatically update in your app.

Next steps:

- Add Stripe's [billing portal](/api-reference/hooks/useCustomer#openbillingportal)
- Handle failed payments
- Use our UI [components](/setup/shadcn) to show a pricing table, and handle upgrades, downgrades and paywalls.
