---
title: "Billing Flows via the API"
sidebarTitle: "with the API"
description: "Use Autumn's API or SDK to roll your own upgrade/downgrade flows, paywalls and more."
---

Autumn handles your billing flows, so you don't need to build and maintain user flows like:

- Purchasing a product
- Inputting quantities for prepaid products
- Upgrading, downgrading, cancelling or renewing a product's subscription
- Paywalling features
- Failed payments [coming soon]

You can use our customizable shadcn/ui components to handle these out-of-the-box, or use our React hooks and SDK to roll your own.

## Product Change

Autumn's `attach` function can be used to enable a product for a customer. Typically when automatically charging a customer's card, you'll want them to confirm the payment. This is useful for upgrade, downgrade or add-on payment flows.

To handle this, call `check`, with `with_preview: true` before the attach call to get purchase preview information that can be displayed to the customer. When they confirm the purchase, you can then call `attach` to enable the product.

<CodeGroup>

```typescript React
import { useAutumn } from "autumn-js/react";

const { check } = useAutumn();

const { data, error } = await check({
  productId: "pro",
  withPreview: true,
});
```

```typescript Node.js
import { Autumn as autumn } from "autumn-js";

const { data, error } = await autumn.check({
  customer_id: "cus_123",
  product_id: "pro",
  with_preview: true,
});
```

```bash cURL
curl -X POST https://api.useautumn.com/v1/check \
  -H "Authorization: Bearer am_sk_xxxxxxxxxx" \
  -H "Content-Type: application/json" \
  -d '{
    "customer_id": "cus_123",
    "product_id": "pro",
    "with_preview": true
  }'
```

</CodeGroup>

<CodeGroup>
```json Upgrade [expandable]
{
    "customer_id": "user_1234",
    "code": "product_found",
    "product_id": "ultra",
    "allowed": false,
    "preview": {
        "title": "Upgrade to Ultra",
        "message": "By clicking confirm, you will upgrade your plan to Ultra and the following amount will be charged to your card immediately:",
        "scenario": "upgrade",
        "product_id": "ultra",
        "product_name": "Ultra",
        "recurring": true,
        "next_cycle_at": 1750604867000,
        "current_product_name": "Pro",
        "items": [
            {
                "price": "-$3.53",
                "description": "Unused time on Pro after 31 May 2025"
            },
            {
                "price": "$7.06",
                "description": "Remaining time on Ultra after 31 May 2025"
            }
        ],
        "options": [
            {
                "feature_id": "seats",
                "feature_name": "seats",
                "billing_units": 1,
                "included_usage": 0,
                "price": 4
            }
        ],
        "due_today": {
            "price": 3.53,
            "currency": "USD"
        },
        "due_next_cycle": {
            "price": 10,
            "currency": "USD"
        },
        "product": {
            "id": "ultra",
            "name": "Ultra",
            "group": null,
            "env": "sandbox",
            "is_add_on": false,
            "is_default": false,
            "version": 1,
            "created_at": 1747926427301,
            "items": [
                {
                    "type": "price",
                    "feature_id": null,
                    "interval": "month",
                    "price": 10
                },
                {
                    "type": "priced_feature",
                    "feature_id": "seats",
                    "feature_type": "continuous_use",
                    "included_usage": 0,
                    "interval": "month",
                    "price": null,
                    "tiers": [
                        {
                            "to": "inf",
                            "amount": 4
                        }
                    ],
                    "usage_model": "prepaid",
                    "billing_units": 1,
                    "reset_usage_when_enabled": true
                },
                {
                    "type": "feature",
                    "feature_id": "chat_messages",
                    "feature_type": "single_use",
                    "included_usage": 20,
                    "interval": "month",
                    "reset_usage_when_enabled": true
                }
            ],
            "free_trial": null
        }
    }
}
```

```json New Purchase
{
  "customer_id": "user_123",
  "code": "product_found",
  "product_id": "ultra",
  "allowed": false,
  "preview": null
}
```

</CodeGroup>

The `check({with_preview: true})` call can return a [`preview` object](/api-reference/check#response-feature-preview) that contains a `scenario` enum, which can be used to control the dialog's contents. `scenario` can be one of the following:

| Scenario    | Description                                                                                               |
| ----------- | --------------------------------------------------------------------------------------------------------- |
| `upgrade`   | The customer is upgrading their product                                                                   |
| `downgrade` | The customer is downgrading to another paid tier                                                          |
| `cancel`    | The customer is downgrading to a free product                                                             |
| `renew`     | The customer is reactivating a product that was previously cancelled                                      |
| `scheduled` | The product is already scheduled to start at a future date (eg, for downgrades), so no changes are needed |
| `active`    | The customer already has the product active, so no changes are needed                                     |

A preview object will be returned if there's an input from the customer required:

- The customer needs to input a quantity for their purchase (ie, if the product has prepaid prices)
- If the customer's payment method is already on file (ie, for upgrades, downgrades or add-ons).

Otherwise, `preview` will be `null`, and you can just call `attach()` directly to generate a checkout URL.

Now you can either build your own flow from scratch, or pass in a component to the `attach()` function.

<Tabs>
<Tab title="Pass in a component">
  You can pass in a custom component (such as a dialog) to the `attach()` function. This will pass down `open`, `setOpen` and `preview` props within a `params` object to the component. You can use these to build your own dialog, or customize our [pre-built shadcn/ui dialog](/quickstart/shadcn).

<CodeGroup>

```jsx PurchaseButton.tsx [expandable]
import { useAutumn } from "autumn-js/react";
import CustomDialog from "./CustomDialog";

export default function PurchaseButton() {
  const { attach } = useAutumn();

  return (
    <button
      onClick={async () => {
        await attach({
          productId: product.id,
          dialog: CustomDialog,
        });
      }}
    >
      Upgrade to Pro
    </button>
  );
}
```

```jsx CustomDialog.tsx [expandable]
import { Button } from "../ui/button";
import { useAutumn } from "autumn-js/react";

interface CustomDialogProps {
  open: boolean;
  setOpen: (open: boolean) => void;
  preview: any;
}

export const CustomDialog = ({ open, setOpen, preview }: CustomDialogProps) => {
  const { attach } = useAutumn();

  console.log(preview?.product_id);
  return (
    <div className="flex absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 h-full max-w-md items-center z-100">
      {open && (
        <div className="flex flex-col gap-2 bg-white p-10 shadow-md border">
          <p>{preview.scenario}</p>
          <Button onClick={() => attach({ productId: preview?.product_id })}>
            Confirm
          </Button>
          <Button onClick={() => setOpen(false)}>Close Dialog</Button>
        </div>
      )}
    </div>
  );
};
```

</CodeGroup>
</Tab>
  <Tab title="Build your own">

```jsx [expandable]
import { useAutumn } from "autumn-js/react";

export default function PurchaseButton() {
  const { attach } = useAutumn();

  return (
    <button
      onClick={async () => {
        const { data } = await check({
          productId: product.id,
          withPreview: true,
        });

        if (data?.preview && window.confirm(data.preview.scenario)) {
          await attach({
            productId: product.id,
          });
        }
      }}
    >
      Upgrade to Pro
    </button>
  );
}
```

  </Tab>
</Tabs>

## Paywall

A paywall that prompts users to upgrade to the next tier when they hit a usage limit, or don't have access to a feature.

#### Install

<CodeGroup>
```bash npm
npx shadcn@latest add https://ui.useautumn.com/classic/paywall-dialog.json
````

```bash pnpm
pnpm dlx shadcn@latest add https://ui.useautumn.com/classic/paywall-dialog.json
```

```bash yarn
yarn dlx shadcn@latest add https://ui.useautumn.com/classic/paywall-dialog.json
```

```bash bun
bunx --bun shadcn@latest add https://ui.useautumn.com/classic/paywall-dialog.json
```

</CodeGroup>

<img
  src="/assets/quickstart/ui-components/paywall-dialog.png"
  alt="Paywall Dialog"
  className="border"
/>

This will download the `pricing-dialog` component in your `/components` directory, under a `/autumn` folder.

You can swap `clean` for `classic` or `dev` in the installation URL to use a different style that suits your brand. View them all at [pricecn.com](https://pricecn.com).

#### Usage

Pass in the `paywall-dialog` component to the `check` function (exported from the `useAutumn` hook).

```jsx
import PaywallDialog from "@components/autumn/paywall-dialog";
import { useAutumn } from "autumn-js/react";

const { check } = useAutumn();

const { data, error } = await check({
  featureId: "ai-messages",
  dialog: PaywallDialog,
});
```

Now when you use the `check()` function, Autumn will automatically pass in the `withPreview: true` parameter. If `data.allowed: false` is returned for the feature, the paywall will open with the following details:

- The feature they don't have access to, or have run out of
- The next product tier they should upgrade to, in order to access the feature (or an add-on if no additional tier exists)
- A button that lets them purchase the next tier or add-on

#### Scenarios

The `check({withPreview: true})` call can return a [`preview` object](/api-reference/check#response-product-preview) that contains a `scenario` enum, which is used to control the dialog's contents. It can be one of the following:

| Scenario       | Description                                        |
| -------------- | -------------------------------------------------- |
| `usage_limit`  | The customer has hit a usage limit for the feature |
| `feature_flag` | The customer doesn't have access to the feature    |

The `preview` object also contains a `products` array, which contains the products that the customer can purchase to access the feature.

When the `pricing-dialog` component is installed, a `/lib/autumn/get-paywall-texts.tsx` file is also installed. This file contains the dialog texts for each scenario (depending on the available products), which you can customize how you want.

```tsx /lib/autumn/get-paywall-texts.tsx [expandable]
import { CheckFeatureFormattedPreview } from "autumn-js";

export const getPaywallDialogTexts = (
  preview: CheckFeatureFormattedPreview
) => {
  const { scenario, products, feature_name } = preview;

  if (products.length == 0) {
    switch (scenario) {
      case "usage_limit":
        return {
          title: `Feature Unavailable`,
          message: `You have reached the usage limit for ${feature_name}. Please contact us to increase your limit.`,
        };
      default:
        return {
          title: "Feature Unavailable",
          message:
            "This feature is not available for your account. Please contact us to enable it.",
        };
    }
  }

  const nextProduct = products[0];

  const isAddOn = nextProduct && nextProduct.is_add_on;

  const title = nextProduct.free_trial
    ? `Start trial for ${nextProduct.name}`
    : nextProduct.is_add_on
    ? `Purchase ${nextProduct.name}`
    : `Upgrade to ${nextProduct.name}`;

  let message = "";
  if (isAddOn) {
    message = `Please purchase the ${nextProduct.name} add-on to continue using ${feature_name}.`;
  } else {
    message = `Please upgrade to the ${nextProduct.name} plan to continue using ${feature_name}.`;
  }

  switch (scenario) {
    case "usage_limit":
      return {
        title: title,
        message: `You have reached the usage limit for ${feature_name}. ${message}`,
      };
    case "feature_flag":
      return {
        title: title,
        message: `This feature is not available for your account. ${message}`,
      };
    default:
      return {
        title: "Feature Unavailable",
        message: "This feature is not available for your account.",
      };
  }
};
```
